<!DOCTYPE html>
<html>
<body>

<title>Modbus RTU2TCP Configuration</title>
<h2>Modbus RTU2TCP Configuration</h2>

<label for="wifi_ssid">Wifi SSID:</label><br>
<input type="text" id="wifi_ssid" name="ssid"><br>
<label for="wifi_pass">Wifi Password:</label><br>
<input type="text" id="wifi_pass" name="wifipass"><br><br>

<label for="uart_baud_rate">Baud rate:</label><br>
<select id="uart_baud_rate">
    <option>9600</option>
    <option>19200</option>
    <option>115200</option>
</select><br>
<label for="uart_parity">Parity:</label><br>
<select id="uart_parity">
    <option value="0">None</option>
    <option value="1">Odd</option>
    <option value="2">Even</option>
</select><br>
<button onclick="applySettings()">Apply</button>

<form action="/restart?confirm=yes">
	<input type="submit" value="Restart" /><br>
	<input type="checkbox" id="confirm" name="confirm" value="yes">Confirm restart</input>
</form>

<div id="demo">
QwQ
</div>

<script>
var fields = ["wifi_ssid", "wifi_pass", "uart_baud_rate", "uart_parity"];

function applySettings() {
	fields.forEach(function(key) {
		var reqUrl = "/config?method=set&field=" + key + "&value=" + encodeURIComponent(document.getElementById(key).value);
		console.log("reqUrl = "+reqUrl);

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				document.getElementById("demo").innerText += "\n" + xhttp.responseText;
			}
		};
		xhttp.open("GET", reqUrl, true);
		xhttp.send();
	});
}

fields.forEach(function(key) {
	var reqUrl = "/config?method=get&field=" + key;
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			document.getElementById(key).value = xhttp.responseText;
		}
	};
	xhttp.open("GET", reqUrl, true);
	xhttp.send();
});

</script>

</body>
</html>