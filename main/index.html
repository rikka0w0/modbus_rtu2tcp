<!DOCTYPE html>
<html>
<body>

<title>Modbus RTU2TCP Configuration</title>
<h2>Modbus RTU2TCP Configuration</h2>

<label for="ssid">Wifi SSID:</label><br>
<input type="text" id="ssid" name="ssid"><br>
<label for="wifipass">Wifi Password:</label><br>
<input type="text" id="wifipass" name="wifipass"><br><br>
<button onclick="applySettings()">Apply</button>

<form action="/restart?confirm=yes">
	<input type="submit" value="Restart" /><br>
	<input type="checkbox" id="confirm" name="confirm" value="yes">Confirm restart</input>
</form>

<div id="demo">
QwQ
</div>

<script>
var fields = ["ssid", "wifipass"];

function formatParams( method, params ){
	return "?method=" + method + "&" +
		Object.keys(params).map(function(key){
			return key+"="+encodeURIComponent(params[key])
		})
		.join("&");
}

function applySettings() {
	var ssid = document.getElementById("ssid").value;
	var wifipass = document.getElementById("wifipass").value;

	var params = {};
	fields.forEach(function(key) {
		params[key] = document.getElementById(key).value;
	});
	var reqUrl = "/config" + formatParams("set", params);
	console.log("reqUrl = "+reqUrl);

	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			document.getElementById("demo").innerHTML = xhttp.responseText;
		}
	};
	xhttp.open("GET", reqUrl, true);
	xhttp.send();
}

fields.forEach(function(key) {
	var params = {};
	params["field"] = key;
	var reqUrl = "/config" + formatParams("get", params);
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			document.getElementById(key).value = xhttp.responseText;
		}
	};
	xhttp.open("GET", reqUrl, true);
	xhttp.send();
});

</script>

</body>
</html>