<!DOCTYPE html>
<html>
<body>

<title>Modbus RTU2TCP Configuration</title>
<h2>Modbus RTU2TCP Configuration</h2>

<label for="wifi_mode">Wifi mode:</label><br>
<select id="wifi_mode">
    <option value = "0">AP mode only</option>
    <option value = "1">STA mode first, AP mode as backup</option>
</select><br>
<label for="wifi_ssid">Wifi SSID:</label><br>
<input type="text" id="wifi_ssid"><br>
<label for="wifi_pass">Wifi Password:</label><br>
<input type="text" id="wifi_pass"><br><br>

<label for="wifi_ssid_ap">AP Mode SSID:</label><br>
Leave empty to use the default SSID (Modbus RTU2TCP [MAC])<br>
<input type="text" id="wifi_ssid_ap"><br>
<label for="wifi_pass_ap">AP Mode Password:</label><br>
<input type="text" id="wifi_pass_ap"><br>
<label for="wifi_auth_ap">AP Auth Mode:</label><br>
<select id="wifi_auth_ap">
    <option value = "0">Open, No password</option>
    <option value = "1">WEP</option>
    <option value = "2">WPA_PSK</option>
    <option value = "3">WPA2_PSK</option>
    <option value = "4">WPA_WPA2_PSK</option>
    <option value = "5">WPA2_ENTERPRISE</option>
    <option value = "6">WPA3_PSK</option>
    <option value = "7">WPA2_WPA3_PSK</option>
</select><br>
<label for="wifi_conn_ap">AP Max No. of Clients:</label><br>
<input type="text" id="wifi_conn_ap"><br>

<br>
<label for="uart_baud_rate">Baud rate:</label><br>
<select id="uart_baud_rate">
    <option>2400</option>
    <option>4800</option>
    <option>9600</option>
    <option>14400</option>
    <option>19200</option>
    <option>28800</option>
    <option>38400</option>
    <option>57600</option>
    <option>115200</option>
    <option>128000</option>
    <option>256000</option>
    <option>921600</option>
</select><br>
<label for="uart_parity">Parity:</label><br>
<select id="uart_parity">
    <option value="0">None</option>
    <option value="1">Odd</option>
    <option value="2">Even</option>
</select><br>
<label for="uart_tx_delay">Tx Delay(us):</label><br>
<input type="text" id="uart_tx_delay" name="uart_tx_delay"><br><br>


<button onclick="applySettings()">Apply</button>

<form action="/restart?confirm=yes">
	<input type="submit" value="Restart" /><br>
	<input type="checkbox" id="confirm" name="confirm" value="yes">Confirm restart</input>
</form>

<div id="demo">
QwQ
</div>

<script>
var fields = ["wifi_mode", "wifi_ssid", "wifi_pass", "wifi_ssid_ap", "wifi_pass_ap", "wifi_auth_ap", "wifi_conn_ap", "uart_baud_rate", "uart_parity", "uart_tx_delay"];

function applySettings() {
	var json_req = {method: "set", fields: {}};
	var fields_req = json_req["fields"];
	fields.forEach(function(key) {
		fields_req[key] = document.getElementById(key).value;
	});

	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			document.getElementById("demo").innerText += "qwq\n";
		}
	};
	xhttp.open("post", "/json_post", true);
	xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhttp.send(JSON.stringify(json_req));
}

function readSettings() {
	var json_req = {method: "get", fields: []};
	fields.forEach(function(key) {
		json_req["fields"].push(key);
	});

	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			var resp = JSON.parse(xhttp.responseText);
			Object.keys(resp).forEach(function(key) {
				document.getElementById(key).value = resp[key];
			});
		}
	};
	xhttp.open("get", "/json_get?json=" + encodeURIComponent(JSON.stringify(json_req)) + "&test=qwq", true);
//xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhttp.send();
}

readSettings();
</script>

</body>
</html>